<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Task Solver 7‚Äì20</title>
    <style>
        body { font-family: Arial; background:#222; color:white; padding:20px; }
        button { padding:10px 20px; margin:5px; cursor:pointer; }
        pre { background:#111; padding:10px; }
    </style>
</head>
<body>

<h2>‚ö° BITK√ñZPONT ‚Äì 7‚Äì20 Feladatok Pontszerz≈ë AI</h2>

<b>Teamcode:</b> 
<input id="teamcode" value="a844b7d39462bf1f46d6" style="width:300px;"><br><br>

<button onclick="loadTask()">Feladat lek√©r√©se</button>
<button onclick="generateSolution()">Megold√°s gener√°l√°sa</button>
<button onclick="submitSolution()">Bek√ºld√©s</button>

<h3>üì• Let√∂lt√∂tt feladat:</h3>
<pre id="taskDisplay">Nincs adat</pre>

<h3>ü§ñ Gener√°lt commands[]:</h3>
<pre id="commandsDisplay">Nincs adat</pre>

<h3>üì§ Bek√ºld√∂tt JSON:</h3>
<pre id="submitDisplay">Nincs adat</pre>

<h3>üì¨ Szerver v√°lasz:</h3>
<pre id="responseDisplay">Nincs adat</pre>

<script>
let loadedTask = null;
let generatedSolution = null;

async function loadTask() {
    const team = document.getElementById("teamcode").value;

    const response = await fetch("https://bitkozpont.mik.uni-pannon.hu/2025/gettasks.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            id: 7,   // MINDIG EZT K√âRI A 7‚Äì20 FELADATOKHOZ
            teamcode: team
        })
    });

    const data = await response.json();
    loadedTask = data;

    document.getElementById("taskDisplay").innerText =
        JSON.stringify(data, null, 2);
}



function generateSolution() {

    if (!loadedTask) {
        alert("Nincs feladat let√∂ltve!");
        return;
    }

    const params = loadedTask.data.questions[0].params;
    const positions = params.positions;
    const shipCount = params.shipCount;

    // -------------------------------
    // EXTRA TUNINGOLT STRAT√âGIA
    // -------------------------------

    const commands = [];
    for (let s = 0; s < shipCount; s++) commands.push([]);

    let baseIndexes = positions
        .map((p, i) => ({ ...p, index: i }))
        .filter(p => p.type === "Base");

    // haj√≥k indul√°sa k√ºl√∂n b√°zisr√≥l
    for (let s = 0; s < shipCount; s++) {
        let b = baseIndexes[s % baseIndexes.length].index;
        commands[s].push({ command: "STARTFROM", position: b });
    }

    // aszteroid√°k list√°z√°sa mennyis√©g szerint cs√∂kken≈ë sorrendben
    let asteroids = positions
        .map((p, i) => ({ ...p, index: i }))
        .filter(p => p.type === "Asteroid")
        .sort((a, b) => b.quantity - a.quantity);

    // sz√©tosztjuk a haj√≥k k√∂z√∂tt a c√©lpontokat
    for (let s = 0; s < shipCount; s++) {
        let shipBase = commands[s][0].position;

        let myAst = asteroids.filter((a, i) => i % shipCount === s);

        for (let a of myAst) {
            commands[s].push({ command: "MOVE", position: a.index });
            commands[s].push({ command: "MINE", rounds: 50 });  // tuning!
        }

        commands[s].push({ command: "MOVE", position: shipBase });
    }

    generatedSolution = {
        commands: commands,
        newShips: []
    };

    document.getElementById("commandsDisplay").innerText =
        JSON.stringify(generatedSolution, null, 2);
}



async function submitSolution() {

    if (!generatedSolution || !loadedTask) {
        alert("Nincs megold√°s gener√°lva!");
        return;
    }

    const team = document.getElementById("teamcode").value;
    const questionID = parseInt(loadedTask.data.questions[0].ID);

    const sendData = {
        id: questionID,
        teamcode: team,
        answer_data: generatedSolution
    };

    document.getElementById("submitDisplay").innerText =
        JSON.stringify(sendData, null, 2);

    const response = await fetch("https://bitkozpont.mik.uni-pannon.hu/2025/answer.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(sendData)
    });

    const result = await response.json();

    document.getElementById("responseDisplay").innerText =
        JSON.stringify(result, null, 2);
}
</script>
</body>
</html>
